#!/usr/bin/env python3
# This file is placed in the Public Domain.
#
# pylint: disable=C0413,C0103,E1121


"""OBJR - objects runtime

    objr  <cmd> [key=val] [key==val]
    objr  [-a] [-c] [-h] [-v]

    options are:

    -a     load all modules
    -c     start console
    -h     show help
    -v     use verbose

    the cmd command show available commands.
    
    $ objr cmd
    cfg,cmd,dpl,err,exp,imp,mod,mre,nme,pwd,rem,res,rss,thr

"""


import os
import readline
import sys
import termios
import time


sys.path.insert(0, os.getcwd())


from objr import Errors, errors
from objz import Cfg, Console, Logging, cmnd, debug, init, parse, scan, wrap


from objz import modules


def main():
    "main"
    parse(Cfg, " ".join(sys.argv[1:]))
    Cfg.mod = ",".join(dir(modules))
    Errors.out = print
    if "v" in Cfg.opts:
        Logging.out = print
        dte = " ".join(time.ctime(time.time()).replace("  ", " ").split()[1:])
        debug(f'{dte} {Cfg.name.upper()} {Cfg.opts.upper()} {Cfg.mod.upper()}'.replace("  ", " "))
    scan(Cfg.mod, modules)
    if "c" in Cfg.opts:
        init(Cfg.mod, modules)
        csl = Console()
        csl.start()
        csl.forever()
    elif Cfg.otxt:
        cmnd(Cfg.otxt)


if __name__ == "__main__":
    wrap(main)
